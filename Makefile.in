# @configure_input@

SHELL=/usr/bin/env bash

ifeq ($(USE_GMAKE),)
GBUILD_OPT:=
else
GBUILD_OPT:=--gmake
endif

prefix = @prefix@
exec_prefix = @exec_prefix@
libdir = @libdir@

all: Makefile dmake/dmake@EXEEXT@ src.downloaded

	@. ./*[Ee]nv.[Ss]et.sh && \
        cd instsetoo_native && \
        build.pl $(GBUILD_OPT) -P@BUILD_NCPUS@ --all -- -P@BUILD_MAX_JOBS@

install:
	@. ./*[Ee]nv.[Ss]et.sh && \
	echo "Installing in $${libdir:-@libdir@}/@INSTALL_DIRNAME@..." && \
	ooinstall "$${libdir:-@libdir@}/@INSTALL_DIRNAME@" && \
	echo "" && \
	echo "Installation finished, you can now execute:" && \
	echo "$${libdir:-@libdir@}/@INSTALL_DIRNAME@/program/soffice"

dev-install:
	@. ./*[Ee]nv.[Ss]et.sh && \
        ooinstall -l @abs_builddir@/install && \
        echo "" && \
        echo "Developer installation finished, you can now execute:" && \
        echo "@abs_builddir@/install/program/soffice"

distclean: dmake/dmake@EXEEXT@
	@. ./*[Ee]nv.[Ss]et.sh && \
        dmake distclean

clean: dmake/dmake@EXEEXT@
	@. ./*[Ee]nv.[Ss]et.sh && \
        dmake clean && \
        if [ -n "$$USE_GMAKE" ] ; then make -f GNUmakefile.mk -sr clean ; fi

dmake/dmake@EXEEXT@:
	@. ./*[Ee]nv.[Ss]et.sh && \
        ./bootstrap

src.downloaded: ooo.lst download
ifeq (@DO_FETCH_TARBALLS@,YES)
	@. ./*[Ee]nv.[Ss]et.sh && \
	$$SRC_ROOT/download $$SRC_ROOT/ooo.lst && touch $@
else
	@echo "Automatic fetching of external tarballs is disabled."
endif

fetch: src.downloaded

Makefile: configure.in set_soenv.in Makefile.in
	./autogen.sh

check: Makefile dmake/dmake@EXEEXT@ fetch
	@. ./*[Ee]nv.[Ss]et.sh && \
	cd smoketestoo_native && \
	export SAL_USE_VCLPLUGIN="svp" && \
        build.pl $(GBUILD_OPT) -P@BUILD_NCPUS@ --all -- -P@BUILD_MAX_JOBS@

id:
	@. ./*[Ee]nv.[Ss]et.sh && \
		create-ids

tags:
	@. ./*[Ee]nv.[Ss]et.sh && \
		create-tags

docs:
	@. ./*[Ee]nv.[Ss]et.sh && \
		mkdocs.sh $$SRC_ROOT/docs $$SOLARENV/inc/doxygen.cfg
