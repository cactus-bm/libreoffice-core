//
// This file is part of the LibreOffice project.
//
// This Source Code Form is subject to the terms of the Mozilla Public
// License, v. 2.0. If a copy of the MPL was not distributed with this
// file, You can obtain one at http://mozilla.org/MPL/2.0/.
//
#include <stdio.h>
#include <TargetConditionals.h>
#define LOK_USE_UNSTABLE_API
#include <LibreOfficeKit/LibreOfficeKitInit.h>

#include <osl/process.h>

#include <unicode/udata.h>
#include <unicode/ucnv.h>

// generated by solenv/bin/native-code.py:
#include "native-code.h"


// Force reference to libreofficekit_hook
extern __attribute__((used)) void *libreofficekit_hook(const char *);
static __attribute__((used)) void *(*foop)(const char *) = libreofficekit_hook;

// pointers to our instance
static LibreOfficeKit* kit;
static LibreOfficeKitDocument* document;


// Bridge functions to LibreOfficeKit
int BridgeLOkit_Init(const char *path)
{
    char bufUserPath[200];
    strcpy(bufUserPath, path);
    strcpy(bufUserPath + strlen(path), "/user");

    // Initialize LibreOfficeKit
    if (!kit) {
        kit = lok_init_2(path, bufUserPath);
        if (!kit)
            return 1;
    }
    return 0;
}



int BridgeLOkit_open(const char *path)
{
    document = kit->pClass->documentLoad(kit, path);
    document->pClass->initializeForRendering(document, "");
    return 0;
}



int BridgeLOkit_ClientCommand(const char *input)
{
  return 0;
}
